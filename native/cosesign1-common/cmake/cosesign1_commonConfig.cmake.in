@PACKAGE_INIT@

# tinycbor may be provided by different package names.
#
# vcpkg's tinycbor port often does not ship a tinycborConfig.cmake, but does provide
# a find_package(tinycbor) wrapper (MODULE mode). So we intentionally do not require
# CONFIG mode here.
find_package(unofficial-tinycbor CONFIG QUIET)
find_package(tinycbor QUIET)

# If neither package created a target, fall back to a minimal imported target.
# This mirrors the in-tree build logic so consumers can still compile header-only
# code that includes <tinycbor/cbor.h>.
if (NOT TARGET tinycbor::tinycbor AND NOT TARGET unofficial::tinycbor::tinycbor AND NOT TARGET tinycbor)
	# Prefer a vcpkg-style layout relative to this config file if present:
	#   <prefix>/share/cosesign1_common/cosesign1_commonConfig.cmake
	#   <prefix>/lib/tinycbor.lib
	#   <prefix>/debug/lib/tinycbor.lib
	get_filename_component(_cosesign1_common_prefix "${CMAKE_CURRENT_LIST_DIR}/../.." ABSOLUTE)

	find_path(TINYCBOR_INCLUDE_DIR NAMES tinycbor/cbor.h HINTS "${_cosesign1_common_prefix}/include")

	set(TINYCBOR_LIBRARY_RELEASE "")
	set(TINYCBOR_LIBRARY_DEBUG "")

	if (EXISTS "${_cosesign1_common_prefix}/lib/tinycbor.lib")
		set(TINYCBOR_LIBRARY_RELEASE "${_cosesign1_common_prefix}/lib/tinycbor.lib")
	endif()
	if (EXISTS "${_cosesign1_common_prefix}/debug/lib/tinycbor.lib")
		set(TINYCBOR_LIBRARY_DEBUG "${_cosesign1_common_prefix}/debug/lib/tinycbor.lib")
	endif()

	# Fall back to normal discovery if we're not in a vcpkg-like prefix.
	if (NOT TINYCBOR_LIBRARY_RELEASE)
		find_library(TINYCBOR_LIBRARY_RELEASE NAMES tinycbor)
	endif()
	if (NOT TINYCBOR_LIBRARY_DEBUG)
		find_library(TINYCBOR_LIBRARY_DEBUG NAMES tinycbor)
	endif()

	if (NOT TINYCBOR_INCLUDE_DIR OR (NOT TINYCBOR_LIBRARY_RELEASE AND NOT TINYCBOR_LIBRARY_DEBUG))
		message(FATAL_ERROR "tinycbor not found (could not locate tinycbor/cbor.h + library)")
	endif()

	add_library(tinycbor::tinycbor UNKNOWN IMPORTED)
	set_target_properties(tinycbor::tinycbor PROPERTIES
		INTERFACE_INCLUDE_DIRECTORIES "${TINYCBOR_INCLUDE_DIR}"
	)

	if (TINYCBOR_LIBRARY_RELEASE)
		set_target_properties(tinycbor::tinycbor PROPERTIES IMPORTED_LOCATION_RELEASE "${TINYCBOR_LIBRARY_RELEASE}")
		set_property(TARGET tinycbor::tinycbor PROPERTY MAP_IMPORTED_CONFIG_RELWITHDEBINFO Release)
		set_property(TARGET tinycbor::tinycbor PROPERTY MAP_IMPORTED_CONFIG_MINSIZEREL Release)
	endif()

	if (TINYCBOR_LIBRARY_DEBUG)
		set_target_properties(tinycbor::tinycbor PROPERTIES IMPORTED_LOCATION_DEBUG "${TINYCBOR_LIBRARY_DEBUG}")
	endif()

	# If only one config exists, fall back to it for the other.
	if (NOT TINYCBOR_LIBRARY_DEBUG AND TINYCBOR_LIBRARY_RELEASE)
		set_target_properties(tinycbor::tinycbor PROPERTIES IMPORTED_LOCATION_DEBUG "${TINYCBOR_LIBRARY_RELEASE}")
	elseif (NOT TINYCBOR_LIBRARY_RELEASE AND TINYCBOR_LIBRARY_DEBUG)
		set_target_properties(tinycbor::tinycbor PROPERTIES IMPORTED_LOCATION_RELEASE "${TINYCBOR_LIBRARY_DEBUG}")
	endif()
endif()

include("${CMAKE_CURRENT_LIST_DIR}/cosesign1_commonTargets.cmake")
